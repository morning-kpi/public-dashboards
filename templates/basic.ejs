
<!DOCTYPE html>
<html>
  <head>
    <title><%= digest.title %> | By Morning</title>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js" integrity="sha512-Wt1bJGtlnMtGP0dqNFH1xlkLBNpEodaiQ8ZN5JLA5wpc1sUlk/O5uuOMNgvzddzkpvZ9GLyYNa8w2s7rqiTk5Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <script src="https://kit.fontawesome.com/a5053dcfb3.js" crossorigin="anonymous"></script>
    <% if (cssURL) { %>
      <link rel="stylesheet" href="<%= cssURL %>" />
    <% } %>
  </head>
  <body>
    <div class="container">
      <section class="hero is-info">
        <div class="hero-body">
          <p class="title">
            <%= digest.title %>
          </p>
          <% if(description) { %>
            <p class="subtitle">
              <%= description %>
            </p>
          <% } %>
        </div>
      </section>
      <section class="section">
        <% digest.kpis.forEach(function(group) { %>
        <div class="group">
          <h2 class="title"><%= group.group.title %></h2>
          <div class="group columns is-multiline">
            <% group.kpis.forEach(function(metric) { %>
              <div class="column is-one-third">
                <div class="metric box">
                  <h3 class="title is-5"><%= metric.icon %>&nbsp;<%= metric.title %></h3>
                  <h1 class="value subtitle is-1 level">
                    <div class="level-left">
                      <% if(metric.format !== 'Currency' && metric.format !== 'Percentage') { %>
                        <%= metric.data.value.toLocaleString() %>
                      <% } else if(metric.format === 'Percentage') { %>
                        <%= metric.data.value.toFixed(1).toLocaleString() %>%
                      <% } else { %>
                        <% 
                          const formatter = new Intl.NumberFormat('en-US', {
                            style: 'currency',
                            currency: 'USD',
                          });
                        %>
                        <%= formatter.format(metric.data.value).replace('.00','') %>
                      <% } %>
                    </div>
                    <% 
                      var className = 'has-text-success';
                      if(metric.data.delta < 0) {
                        className = 'has-text-danger';
                      }
                      if(metric.data.delta === 0) {
                        className = 'has-text-grey-light';
                      }
                    %>
                    <div class='level-right <%= className %> is-size-5'>
                      <% if(metric.data.delta > 0) { %>
                        <i class="fas fa-arrow-up"></i>
                      <% } %>
                      <% if(metric.data.delta < 0) { %>
                        <i class="fas fa-arrow-down"></i>
                      <% } %>&nbsp;
                      <%= (metric.data.delta * 100).toFixed(1).toLocaleString() %>%
                    </div>
                  </h1>
                </div>
              </div>
            <% }); %>
          </div>
        </div>
      <% }); %>
      </section>
    <footer class="footer">
      <div class="content has-text-centered">
        <p>
          Generated by <a href="https://morning.so">Morning</a> on 
          <%= new Date().toLocaleDateString() %> at 
          <%= new Date().toLocaleTimeString() %>
        </p>
      </div>
    </footer>
    </div>
  </body>
</html>